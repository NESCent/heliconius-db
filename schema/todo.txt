==Open Issues of the Diversity extension==

===Table Pedigree===

* Split out pedigree.{date_mated,date_female_died,days_mated} into pedigree_cvterm?
* Same thing with specimen.{barcode,...}?

===Table Genotype===

We are interested in storing linear arrays of locus-specific DNA
sequence data as genotypic data.  One way would be to make
genotype.description have unlimited length (text?).  Other way is
to use accession to the data in Genbank, i.e. add accession fkey to
genotype table.

===Table Stock===

* Columns maternal_source_id and paternal_source_id should be better named maternal_biotype_id and paternal_biotype_id for consistency?

* Is this the site where the individual(s) that gave rise to the stock were collected from, or is this the location of the stock itself?

===Table Biotype===

This relation only has a primary key and no natural attributes. What is its purpose?

===Table Biotype_Organism===

Seems to serve as an association table between Biotype and
Organism. Why would one associate multiple organisms (taxonomic units)
with a single biotype?
 
===Table Geographic_Site===

* county, province, and country seem to be denormalized, and possibly
belong into a controlled vocabulary
** Yes.

===Table Experimenter===

This should be rather represented by module contact, table contact?

* Yes.

===Table Individual===

* Columns 'male' and 'wild' aren't named as obviously boolean
attributes; in fact shouldn't they rather be cvterm references?

* Column 'notes' does not sound like a desirable idea. What is to be noted here?

* The table has a self-referencing foreign key. Is this used to store lineages?

===Table Cross_Type===

This looks like it is a controlled vocabulary, and hence should be
merged into tables cv and cvterm.

* Yes.

===Table Pedigree===

There are a number of commented out columns. Are they needed or not?

* Can be removed.

===Table Pedigree_cvterm===

* What is the column cvterm_type for? Can this be removed? This sounds
  like it is redundant to the cvterm foreign key and the cvterm's
  namespace?

===Table Polytype===

This looks like it is a controlled vocabulary, and hence should be
merged into tables cv and cvterm.

* Yes.

===Table Primer===

This should be represented by module sequence, table feature.

* Yes.

===Table Primer_Designcluster===

Column naming is inconsistent (design_species_id should be
design_organism_id, outgroup_id should be outgroup_organism_id,
designcluster_id should be feature_id, pos should be unambiguous).

===Table gtassay===

Inconsistent column naming (locus_id should be feature_id, or locus_feature_id).

This could possibly be represented also be a primer feature pair and a
super-feature giving the amplicon.

* Revisit, probably not.

===Table gtassay_cvterm===

* What is the column cvterm_type for? Can this be removed? This sounds
  like it is redundant to the cvterm foreign key and the cvterm's
  namespace?

===Table Specimen===

Column storage_location looks like a cvterm foreign key candidate.

* No, is possibly an exact location.

===Table Gtexperiment===

Column genotype_published_id should be better named (e.g., simply
pub_id).

And does this column refer to the publication for the genotype or for
the genotype experiment?

===Table Studyx===

* Why name the table StudyX? What is this table for?
** Maybe expstudy?

* This looks rather like a controlled vocabulary, to be folded into
the cv and cvterm tables.
** No.

===Table Image===

This may be representable as a dbxref (table dbxref, module general).

* Probably yes.

===Table Pcrexperiment===

* What is the definition for the table? I.e., what is the conceptual
entity? Documentation says 'initial examination'; why not subsequent
examinations? Why is this not a gtassay_result? How is this entity fundamentally
different from a gtexperiment?

* Expected_length should be calculable based on amplicon?

* test_species_id: should be named test_organism_id, or possibly
differently to better reflect the conceptual model?

* columns intron and outcome_success should rather be cvterm foreign keys?

See change to pcrexperiment.

===Table Ptassay===

* This looks rather like a controlled vocabulary?
** No.

* Documentation says 'polymorphism detection'; however, is this rather a 
phenotype assay?
** Yes, fixed.

* What is the column cvterm_type for? Can this be removed? This sounds
  like it is redundant to the cvterm foreign key and the cvterm's
  namespace?

===Table individual_phenotype===

* Phenotype_published_id should be just pub_id. Does column
  phenotype_published_id refer to the publication for the phenotype or
  for the phenotype itself?

* What is column 'notes' for?
** Maybe not needed.

===Table Stock_Phenotype===

* Phenotype_published_id should be just pub_id. Does column
  phenotype_published_id refer to the publication for the phenotype or
  for the phenotype itself?

* What is column 'notes' for?
** Maybe not be needed.

===Table Biotype_Phenotype===

* Phenotype_published_id should be just pub_id. Does column
  phenotype_published_id refer to the publication for the phenotype or
  for the phenotype itself?

* What is column 'notes' for?
** Maybe not needed.

==Open issues due to conflict with other modules==

Need to be able to store short taxonomies for organisms, specifically
class, order, family, subfamily, and possibly also subspecies. There
seem to be multiple possibilities (using the organism, cvterm, or
phylogeny modules, which each have facilitiies for hierarchical
relationships) and conflicting recommendations (organism documentation
says to use cvterm or phylogeny, but example uses organism and even
violates NOT NULL constraint).

Here is what the original evo.psql definition did to address the issue:

ALTER TABLE organism ADD COLUMN "class" character varying(255);
ALTER TABLE organism ADD COLUMN "order" character varying(255);
ALTER TABLE organism ADD COLUMN family character varying(255);
ALTER TABLE organism ADD COLUMN subfamily character varying(255);
ALTER TABLE organism ADD COLUMN subspecies character varying(255);

UPDATE organism SET "class" = '';
UPDATE organism SET "order" = '';
UPDATE organism SET family = '';
UPDATE organism SET subfamily = '';
UPDATE organism SET subspecies = '';
ALTER TABLE organism ALTER COLUMN "class" SET NOT NULL;
ALTER TABLE organism ALTER COLUMN "order" SET NOT NULL;
ALTER TABLE organism ALTER COLUMN family SET NOT NULL;
ALTER TABLE organism ALTER COLUMN subfamily SET NOT NULL;
ALTER TABLE organism ALTER COLUMN subspecies SET NOT NULL;

COMMENT ON COLUMN organism.subspecies IS 'Subspecies, variety, forma, etc.';

-- ALTER TABLE organism DROP CONSTRAINT organism_c1;
-- ALTER TABLE organism DROP CONSTRAINT organism_genus_key;
ALTER TABLE organism
	ADD CONSTRAINT organism_genus_key UNIQUE (genus, species, subfamily, subspecies);
